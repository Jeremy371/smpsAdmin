<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.humane.smps.mapper.ModelMapper">
    <select id="toolbar" resultType="com.humane.smps.dto.StatusDto">
        SELECT
        admission.admission_nm,
        exam.exam_nm,
        exam_hall_date.hall_date AS exam_date,
        hall.head_nm,
        hall.bldg_nm,
        hall.hall_nm,
        examinee.dept_nm,
        examinee.major_nm
        FROM exam_map
        INNER JOIN exam ON exam.exam_cd = exam_map.exam_cd
        INNER JOIN hall ON hall.hall_cd = exam_map.hall_cd
        INNER JOIN exam_hall_date ON exam_hall_date.exam_cd = exam.exam_cd AND exam_hall_date.hall_cd = hall.hall_cd
        INNER JOIN admission ON admission.admission_cd = exam.admission_cd
        INNER JOIN examinee ON examinee.examinee_cd = exam_map.examinee_cd
        <where>
            <if test="param != null">
                <if test="param.admissionNm != null">AND admission.admission_nm = #{param.admissionNm}</if>
                <if test="param.examNm != null">AND exam.exam_nm = #{param.examNm}</if>
                <if test="param.examDate != null">AND exam_hall_date.exam_date = #{param.examDate}</if>
                <if test="param.headNm != null">AND hall.head_nm = #{param.headNm}</if>
                <if test="param.bldgNm != null">AND hall.bldg_nm = #{param.bldgNm}</if>
                <if test="param.hallNm != null">AND hall.hall_nm = #{param.hallNm}</if>
                <if test="param.deptNm != null">AND examinee.dept_nm = #{param.deptNm}</if>
                <if test="param.majorNm != null">AND examinee.major_nm = #{param.majorNm}</if>
                <if test="param.userAdmissions != null">AND exam.admission_cd IN (${param.userAdmissions})</if>
            </if>
        </where>
        GROUP BY admission.admission_nm
            , exam.exam_nm
            , exam_hall_date.hall_date
            , hall.head_nm, hall.bldg_nm, hall.hall_nm
            , examinee.dept_nm, examinee.major_nm
    </select>
</mapper>